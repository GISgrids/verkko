
#  The 'jobscript' is a template used to form the script submitted to the custer
#  for execution.  The script consists of a call to snakemake to run the
#  task.  By default, Verkko makes a copy of this script in the
#  {work_directory}/scripts/ folder.
#
#  The 'cluster' script is responsible for submitting the script created by
#  'jobscript' to the grid for execution.  It expects at least three
#  arguments (the numbe rof compute threads to use, the amount of memory in
#  megabytes needed, and the maximum run time allowed, all supplied by
#  snakemake) with the remaining arguments passed to the end of the submit
#  command.  The Verkko submit script supports Slurm and SGE.
#
#  Snakemake can substitute the following variables into the cluster command
#  line:
#    {threads}          - number of threads the rule requests
#    {resources.mem_gb} - amount of memory. in megabytes, the rule requests (Verkko specific)
#    {resources.time_h} - time, in hours, the rule requests (Verkko specific)
#    {name}             - the name of the rule running?
#    {rulename}         - the name of the rule running
#    {input}            - list of all the inputs
#    {output}           - list of all the outputs
#    {params}           - list of all the parameters
#    {wildcards}        - 
#    {log}              - list of all the log files
#    {dependencies}     - 
#
#
#  The 'cluster-status' script is responsible for returning the status of the
#  job ID supplied on the command line: 'running', 'success' or 'failed'.
#  The Verkko status script supports Slurm and SGE.

jobscript:      "/data/walenzbp/verkko/profiles/jobscript.sh"
cluster:        "/data/walenzbp/verkko/profiles/slurm-sge-submit.sh {threads} {resources.mem_gb} {resources.time_h} {rulename} {params.jobid}"
cluster-status: "/data/walenzbp/verkko/profiles/slurm-sge-status.sh"

#  cluster /might/ expand name, rulename, input, output, params, wildcards,
#  log, threads, dependencies.

#  cluster-status is given a job id as the first and only arg.
#  Expected to print 'running', 'success', 'failed' to stdout.

#  Number of times to retry failing jobs.
restart-times: 5
restart-times: 0

max-jobs-per-second: 10

#  Check status every 50 seconds.
max-status-checks-per-second: 0.02


#  Define a nice custom jobname for us.
#    {name}  - the name of the rule being run.
#    {jobid} - the snakemake job id for this job.  Must be present.
#
jobname: verkko.{name}.{jobid}.sh


cores: 99        #  How many jobs to run at once
local-cores: 1   #  How many cores to use locally

rerun-incomplete: true
keep-going:       false

printshellcmds: true
#no-shared-fs: true

default-resources:
 - n_cpus=2
 - mem_gb=100
 - time_h=3
